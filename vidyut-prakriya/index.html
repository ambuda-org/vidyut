<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="data:,"><!-- Avoid favicon requests: https://stackoverflow.com/a/38917888 -->
  <title>Vidyullekha</title>
  <style>
    table {
      border-collapse: collapse;
      border: 2px solid black;
      margin: 20px;
    }

    td,
    th {
      border: 1px solid black;
      padding: 5px 10px;
    }

  </style>

  <script type="module">
    import init, { demo, Gana, Lakara, Prayoga, Purusha, Vacana } from "./pkg/vidyut_prakriya.js";
    await init();
    window.demo = demo;
    window.Gana = Gana;
    window.Lakara = Lakara;
    window.Prayoga = Prayoga;
    window.Purusha = Purusha;
    window.Vacana = Vacana;
    if (typeof Alpine === 'undefined') {
      document.addEventListener('alpine:init', () => { runDemo(); })
    } else {
      runDemo();
    }
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/@indic-transliteration/sanscript@1.2.7/sanscript.min.js"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script>
    document.addEventListener('alpine:init', () => {
      Alpine.store('ret', {});
    });
    function runDemo(dhatu, refs) {
      Alpine.store('vidyutImported', true);
      if (refs) {
        console.log(`gaṇa:${refs.ganaChoice.value}, lakāra:${refs.lakaraChoice.value}, prayoga:${refs.prayogaChoice.value}, puruṣa:${refs.purushaChoice.value}, vacana:${refs.vacanaChoice.value}`);
        var gana = Gana[refs.ganaChoice.value];
        var lakara = Lakara[refs.lakaraChoice.value];
        var prayoga = Prayoga[refs.prayogaChoice.value];
        var purusha = Purusha[refs.purushaChoice.value];
        var vacana = Vacana[refs.vacanaChoice.value];
      } else {
        console.log('Using default inputs');
        dhatu = "qukf\\Y";
        var gana = Gana.Kryadi;
        var lakara = Lakara.Lat;
        var prayoga = Prayoga.Kartari;
        var purusha = Purusha.Prathama;
        var vacana = Vacana.Eka;
      };
      console.log(`Calling demo with dhātu:${dhatu}, gaṇa:${gana}, lakāra:${lakara}, prayoga:${prayoga}, puruṣa:${purusha}, vacana:${vacana}`);
      const ret = demo(dhatu, gana, lakara, prayoga, purusha, vacana);
      console.log(ret);
      Alpine.store('ret', ret);
    }
    function deva(s) { return Sanscript.t(s, 'slp1', 'devanagari'); }
  </script>
</head>

<body>
  <h1>Demo of <a href="https://github.com/ambuda-org/vidyut/tree/main/vidyut-prakriya">vidyut-prakriya</a></h1>
  <h3>Tiṅanta</h3>
  <!-- https://github.com/alpinejs/alpine/issues/359 -->
  <div x-data>
    <template x-if="!$store.vidyutImported">
      <div>
        (Loading...)
      </div>
    </template>
  </div>
  <div x-data>
    <template x-if="$store.vidyutImported">
      <div>
        <!-- Input to the demo. -->
        <div x-data="{dhatu: 'BU'}">
          <label>Enter <i>dhātu</i> in <i>aupadeśika</i> form in SLP1:</label>
          <input x-model="dhatu">
          <br>
          <label for="ganaChoice">Choose a <i>gaṇa</i>:</label>
          <select name="ganaChoice" id="ganaChoice" x-ref="ganaChoice">
            <template x-for="g in Gana">
              <option :value="g" x-text="g"></option>
            </template>
          </select>
          <br>
          <label for="lakaraChoice">Choose a <i>lakāra</i>:</label>
          <select name="lakaraChoice" id="lakaraChoice" x-ref="lakaraChoice">
            <template x-for="g in Lakara">
              <option :value="g" x-text="g"></option>
            </template>
          </select>
          <br>
          <label for="prayogaChoice">Choose a <i>prayoga</i>:</label>
          <select name="prayogaChoice" id="prayogaChoice" x-ref="prayogaChoice">
            <template x-for="g in Prayoga">
              <option :value="g" x-text="g"></option>
            </template>
          </select>
          <br>
          <label for="purushaChoice">Choose a <i>puruṣa</i>:</label>
          <select name="purushaChoice" id="purushaChoice" x-ref="purushaChoice">
            <template x-for="g in Purusha">
              <option :value="g" x-text="g"></option>
            </template>
          </select>
          <br>
          <label for="vacanaChoice">Choose a <i>vacana</i>:</label>
          <select name="vacanaChoice" id="vacanaChoice" x-ref="vacanaChoice">
            <template x-for="g in Vacana">
              <option :value="g" x-text="g"></option>
            </template>
          </select>
          <br>
          <button x-on:click="runDemo(dhatu, $refs)">Generate</button>
        </div>
        <!-- Output from the demo. -->
        <div style="display: flex">
          <template x-for="p in $store.ret">
            <table>
              <caption x-text="deva(p.terms.map(t => t.text).join(''))"></caption>
              <thead>
                <tr>
                  <th>Rule</th>
                  <th>Result</th>
                </tr>
              </thead>
              <tbody>
                <template x-for="step in p.history">
                  <tr>
                    <td x-text="step.rule"></td>
                    <td x-text="deva(step.result)"></td>
                  </tr>
                </template>
              </tbody>
            </table>
          </template>
        </div>
      </div>
    </template>
  </div>
</body>

</html>
